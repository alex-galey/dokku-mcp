name: deploy_staging
description: Deploy an application to staging environment with health checks
owner_plugin: core
arguments:
  - name: app_name
    type: string
    description: Name of the application to deploy
    required: true
  - name: git_ref
    type: string
    description: Git reference to deploy
    required: false
    default: main

steps:
  - name: create_app
    type: tool_call
    target: create_application
    arguments:
      name: "${app_name}"
    condition: ""
    output_alias: create_result

  - name: deploy_app
    type: tool_call
    target: deploy_application
    arguments:
      name: "${app_name}"
      git_ref: "${git_ref}"
    output_alias: deploy_result

  - name: scale_app
    type: tool_call
    target: scale_application
    arguments:
      name: "${app_name}"
      process_type: web
      scale: 1
    output_alias: scale_result

  - name: check_status
    type: read_resource
    target: "dokku://app/${app_name}"
    arguments: {}
    output_alias: app_status 